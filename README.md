# MsiProxy #

The MSI-Proxy provides a single point of entry for accessing MSI data from various data sources in a unified format.

## Providers ##

At the time of writing, the MSI-Proxy defines two MSI providers:

* **dkmsi**: provides MSI messages from the Danish legacy MSI-admin production system.
* **dkmsinm**: provides MSI messages from the Danish test MSI-NM system.

## Interfaces ##

The MSI-Proxy exposes MSI data using several methods.

### Simple HTML Page ###
A simple server-side generated HTML page is available at the URI:

    /details.html?provider=<<PROVIDER>>&lang=<<LANG>>

Where *provider* is one of the available providers, i.e. "dkmsi" or "dkmisnm", and *lang* is one of the supported languages, i.e. "da" or "en".

The page can e.g. be used in an iframe, and since it is fairly simple and completely generated on the server side, it should be backwards compatible with most browsers.

Example: [http://localhost:8080/details.html?provider=dkmsi&lang=da](http://localhost:8080/details.html?provider=dkmsi&lang=da)

### PDF File ###
A PDF file can be generated by changing ".html" to ".pdf" in the simple HTML page described above.

Example: [http://localhost:8080/details.pdf?provider=dkmsi&lang=da](http://localhost:8080/details.pdf?provider=dkmsi&lang=da)

### Single Page Application ###
A more sophisticated AngularJS based single page application is available at the URI:

    /index.html#/<<PROVIDER>>/<<LANG>>/<<VIEWMODE>>

Where *provider* is one of the available providers, i.e. "dkmsi" or "dkmisnm", and *lang* is one of the supported languages, i.e. "da" or "en".
*Viewmode* is one of "details", "grid" or "map", and defines how the messages are displayed.

The page can e.g. be used in an iframe. It is more sophisticated than the simple HTML page previously described, but may not work properly in old web browsers.

Example: [http://localhost:8080/index.html#/dkmsi/da/details](http://localhost:8080/index.html#/dkmsi/da/details)

### REST API ###

Each MSI provider exposes a REST API that may be used to fetch JSON or XML data for the list of active MSI messages.
The REST API has the URI format:

    /rest/<<PROVIDER>>/<<VERSION>>/service/messages?<<PARAMETERS>>

Where *provider* is one of the available providers, i.e. "dkmsi" or "dkmisnm", and *version* is the API version, i.e. "v1".
The *parameters* are described below:

| Parameter  | Default | Description  |
| ---------- | ------- | ----- |
| refresh    | false   | Can be used to ensure that data is refreshed from the backend. Normally, cached data is used. |
| format     | json    | Either "json" or "xml". Defines the format of the returned data. |
| lang       | da      | The language. The current providers support "da" and "en" |
| details    | true    | Non-detailed data exclude certain message properties to allow for a more compact format. |
| types      |         | A comma-separated list of message types, e.g. "MSI" or "NM" or any of the sub-types. |
| areaId     |         | Can be used to restrict the messages to a certain area (including all sub-areas). |
| categoryId |         | Can be used to restrict the messages to a certain category (including all sub-categories). |

Example: [http://localhost:8080/rest/dkmsi/v1/service/messages?lang=da](http://localhost:8080/rest/dkmsi/v1/service/messages?lang=da)


## Prerequisites
* Java JDK 1.8
* Maven 3.x
* JBoss Wildfly 8.2.0.Final or later
* MySQL

## Initial setup

### MySQL
On the server running the MSI-Proxy, you need to set up a MySQL database with imported data from the legacy MSI-admin production system.

The procedure is described in [msiproxy-provider-dkmsi/README.md](msiproxy-provider-dkmsi/README.md).

### JBoss Wildfly

#### Configuration
Install and configure the Wildfly application server by running:

    ./install-widlfly.sh
    ./configure-widlfly.sh

#### Local Deployment (Development)

Start Wildfly using the command:

    ./wildfly-8.2.0.Final/bin/standalone.sh

Build and deploy the MSI-Proxy web application using:

    mvn clean install
    cd msiproxy-web
    mvn wildfly:deploy

You can now access the web application on: [http://localhost:8080/](http://localhost:8080/)

#### Remote Deployment (Production)

Initially, on the remote Wildfly server, configure a management user:

    ./wildfly-8.2.0.Final/bin/add-user.sh

Start Wildfly using the command:

    ./wildfly-8.2.0.Final/bin/standalone.sh -b 0.0.0.0 -bmanagement=0.0.0.0 -Djboss.socket.binding.port-offset=0 -DbaseUri=<<SERVER URI>>

Build and deploy the MSI-Proxy web application using:

    mvn wildfly:deploy -Dwildfly.hostname=<<REMOTE SERVER>> -Dwildfly.port=9990 -Dwildfly.username=<<USER NAME> -Dwildfly.password=<<PASSWORD>>

